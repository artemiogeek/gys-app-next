# üÜï CRM Implementation Specification - Sistema GYS

## üìã Resumen Ejecutivo

Este documento detalla la implementaci√≥n completa de un sistema CRM (Customer Relationship Management) especializado para proyectos industriales en el sistema GYS. El CRM se integra perfectamente con el flujo existente de cotizaciones y proyectos, manteniendo la funcionalidad actual intacta mientras agrega capacidades avanzadas de gesti√≥n de relaciones comerciales.

## üéØ Objetivos del Sistema CRM

- **Gesti√≥n de Oportunidades**: Seguimiento completo del pipeline de ventas
- **An√°lisis de Competidores**: Informaci√≥n detallada sobre competidores en licitaciones
- **Gesti√≥n de Contactos**: Base de datos de contactos por cliente
- **Historial de Proyectos**: Registro hist√≥rico de proyectos por cliente
- **M√©tricas Comerciales**: KPIs y m√©tricas de rendimiento por usuario
- **Integraci√≥n Fluida**: Con el sistema existente de cotizaciones y proyectos

---

## üóÑÔ∏è Arquitectura de Base de Datos

### üìã Nuevos Modelos CRM

#### 1. CrmOportunidad
```prisma
model CrmOportunidad {
  id                    String   @id @default(cuid())
  clienteId             String
  nombre                String
  descripcion           String?
  valorEstimado         Float?
  probabilidad          Int      @default(0) // 0-100
  fechaCierreEstimada   DateTime?
  fuente                String?  // "licitaci√≥n", "referido", "prospecci√≥n"
  estado                String   @default("prospecto")
  prioridad             String   @default("media")
  comercialId           String?
  responsableId         String?
  fechaUltimoContacto   DateTime?
  notas                 String?
  competencia           String?
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  // Relaciones
  cliente               Cliente  @relation(fields: [clienteId], references: [id])
  comercial             User?    @relation("CrmOportunidadComercial", fields: [comercialId], references: [id])
  responsable           User?    @relation("CrmOportunidadResponsable", fields: [responsableId], references: [id])
  cotizacionId          String?  @unique
  cotizacion            Cotizacion? @relation(fields: [cotizacionId], references: [id])
  actividades           CrmActividad[]

  @@index([clienteId, estado])
  @@index([comercialId, fechaCierreEstimada])
  @@map("crm_oportunidad")
}
```

#### 2. CrmActividad
```prisma
model CrmActividad {
  id            String   @id @default(cuid())
  oportunidadId String
  tipo          String   // "llamada", "email", "reuni√≥n", "propuesta", "seguimiento"
  descripcion   String
  fecha         DateTime
  resultado     String?  // "positivo", "neutro", "negativo"
  notas         String?
  usuarioId     String
  usuario       User     @relation(fields: [usuarioId], references: [id])
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  oportunidad   CrmOportunidad @relation(fields: [oportunidadId], references: [id], onDelete: Cascade)

  @@index([oportunidadId, fecha])
  @@map("crm_actividad")
}
```

#### 3. CrmCompetidorLicitacion
```prisma
model CrmCompetidorLicitacion {
  id              String   @id @default(cuid())
  cotizacionId    String
  nombreEmpresa   String
  contacto        String?
  telefono        String?
  email           String?
  propuestaEconomica Float?
  propuestaTecnica   String?
  fortalezas         String?
  debilidades        String?
  precioVsNuestro    String?
  resultado         String?
  razonPerdida      String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  cotizacion        Cotizacion @relation(fields: [cotizacionId], references: [id], onDelete: Cascade)

  @@index([cotizacionId])
  @@map("crm_competidor_licitacion")
}
```

#### 4. CrmContactoCliente
```prisma
model CrmContactoCliente {
  id            String   @id @default(cuid())
  clienteId     String
  nombre        String
  cargo         String?
  email         String?
  telefono      String?
  celular       String?
  esDecisionMaker     Boolean  @default(false)
  areasInfluencia     String?
  relacionComercial   String?
  fechaUltimoContacto DateTime?
  notas               String?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  cliente             Cliente  @relation(fields: [clienteId], references: [id], onDelete: Cascade)

  @@index([clienteId, esDecisionMaker])
  @@map("crm_contacto_cliente")
}
```

#### 5. CrmHistorialProyecto
```prisma
model CrmHistorialProyecto {
  id              String   @id @default(cuid())
  clienteId       String
  proyectoId      String?
  cotizacionId    String?
  nombreProyecto  String
  tipoProyecto    String
  sector          String?
  complejidad     String?
  valorContrato   Float?
  margenObtenido  Float?
  duracionDias    Int?
  fechaInicio     DateTime?
  fechaFin        DateTime?
  fechaAdjudicacion DateTime?
  calificacionCliente Int?
  retroalimentacion  String?
  exitos            String?
  problemas         String?
  recomendaciones   String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  cliente           Cliente     @relation(fields: [clienteId], references: [id], onDelete: Cascade)
  proyecto          Proyecto?   @relation(fields: [proyectoId], references: [id])
  cotizacion        Cotizacion? @relation(fields: [cotizacionId], references: [id])

  @@index([clienteId, fechaInicio])
  @@index([tipoProyecto, sector])
  @@map("crm_historial_proyecto")
}
```

#### 6. CrmMetricaComercial
```prisma
model CrmMetricaComercial {
  id                    String   @id @default(cuid())
  usuarioId             String
  periodo               String   // "2024-09", "2024-Q3", "2024"
  cotizacionesGeneradas Int      @default(0)
  cotizacionesAprobadas Int      @default(0)
  proyectosCerrados     Int      @default(0)
  valorTotalVendido     Float    @default(0)
  margenTotalObtenido   Float    @default(0)
  tiempoPromedioCierre  Float?
  tasaConversion        Float?
  valorPromedioProyecto Float?
  llamadasRealizadas    Int      @default(0)
  reunionesAgendadas   Int      @default(0)
  propuestasEnviadas    Int      @default(0)
  emailsEnviados        Int      @default(0)
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  usuario               User     @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@unique([usuarioId, periodo])
  @@index([periodo])
  @@map("crm_metrica_comercial")
}
```

### üîÑ Modelos Actualizados

#### Cliente (Actualizado)
```prisma
model Cliente {
  id              String       @id @default(cuid())
  codigo          String       @unique
  numeroSecuencia Int?         @default(1)
  nombre          String
  ruc             String?
  direccion       String?
  telefono        String?
  correo          String?
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  // ‚úÖ NUEVOS CAMPOS PARA CRM
  sector          String?      // "miner√≠a", "manufactura", "energ√≠a", "construcci√≥n"
  tamanoEmpresa   String?      // "peque√±a", "mediana", "grande", "multinacional"
  sitioWeb        String?
  linkedin        String?
  potencialAnual  Float?       // Valor estimado de proyectos por a√±o
  frecuenciaCompra String?     // "muy_alta", "alta", "media", "baja"
  ultimoProyecto  DateTime?
  estadoRelacion  String       @default("prospecto")
  calificacion    Int?         @default(3) // 1-5

  // Relaciones existentes
  cotizaciones    Cotizacion[]
  proyectos       Proyecto[]

  // ‚úÖ NUEVAS RELACIONES PARA CRM
  oportunidades    CrmOportunidad[]
  contactos        CrmContactoCliente[]
  historialProyectos CrmHistorialProyecto[]
}
```

#### Cotizacion (Actualizado)
```prisma
model Cotizacion {
    // ... campos existentes ...

    // ‚úÖ NUEVOS CAMPOS PARA CRM
    etapaCrm              String?  @default("nuevo")
    prioridadCrm          String?  @default("media")
    probabilidadCierre    Int?     @default(0)
    fechaUltimoContacto   DateTime?
    fechaProximaAccion    DateTime?
    proximaAccion         String?
    competencia           String?
    posicionVsCompetencia String?
    razonCierre           String?
    retroalimentacionCliente String?

    // ‚úÖ NUEVAS RELACIONES PARA CRM
    oportunidadCrm        CrmOportunidad?
    competidoresCrm       CrmCompetidorLicitacion[]
    historialProyectos    CrmHistorialProyecto[]
}
```

#### User (Actualizado)
```prisma
model User {
  // ... campos existentes ...

  // ‚úÖ NUEVAS RELACIONES PARA CRM
  oportunidadesComercial        CrmOportunidad[]  @relation("CrmOportunidadComercial")
  oportunidadesResponsable      CrmOportunidad[]  @relation("CrmOportunidadResponsable")
  actividadesCrm               CrmActividad[]
  metricasComerciales          CrmMetricaComercial[]
}
```

---

## üîå APIs y Endpoints

### üìã API Routes Structure

```
src/app/api/crm/
‚îú‚îÄ‚îÄ oportunidades/
‚îÇ   ‚îú‚îÄ‚îÄ route.ts              # GET, POST /api/crm/oportunidades
‚îÇ   ‚îú‚îÄ‚îÄ [id]/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ route.ts          # GET, PUT, DELETE /api/crm/oportunidades/[id]
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ actividades/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ route.ts      # GET, POST /api/crm/oportunidades/[id]/actividades
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ competidores/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ route.ts      # GET, POST /api/crm/oportunidades/[id]/competidores
‚îú‚îÄ‚îÄ clientes/
‚îÇ   ‚îú‚îÄ‚îÄ [id]/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ contactos/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ route.ts      # GET, POST /api/crm/clientes/[id]/contactos
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ historial/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ route.ts      # GET /api/crm/clientes/[id]/historial
‚îú‚îÄ‚îÄ metricas/
‚îÇ   ‚îú‚îÄ‚îÄ route.ts              # GET /api/crm/metricas
‚îÇ   ‚îî‚îÄ‚îÄ [usuarioId]/
‚îÇ       ‚îî‚îÄ‚îÄ route.ts          # GET /api/crm/metricas/[usuarioId]
‚îî‚îÄ‚îÄ dashboard/
    ‚îî‚îÄ‚îÄ route.ts              # GET /api/crm/dashboard
```

### üìä Endpoints Detallados

#### Oportunidades
- `GET /api/crm/oportunidades` - Lista de oportunidades con filtros
- `POST /api/crm/oportunidades` - Crear nueva oportunidad
- `GET /api/crm/oportunidades/[id]` - Detalles de oportunidad
- `PUT /api/crm/oportunidades/[id]` - Actualizar oportunidad
- `DELETE /api/crm/oportunidades/[id]` - Eliminar oportunidad

#### Actividades
- `GET /api/crm/oportunidades/[id]/actividades` - Lista de actividades
- `POST /api/crm/oportunidades/[id]/actividades` - Crear nueva actividad

#### Competidores
- `GET /api/crm/oportunidades/[id]/competidores` - Lista de competidores
- `POST /api/crm/oportunidades/[id]/competidores` - Agregar competidor

#### Contactos
- `GET /api/crm/clientes/[id]/contactos` - Lista de contactos del cliente
- `POST /api/crm/clientes/[id]/contactos` - Crear nuevo contacto

#### Historial
- `GET /api/crm/clientes/[id]/historial` - Historial de proyectos del cliente

#### M√©tricas
- `GET /api/crm/metricas` - M√©tricas generales
- `GET /api/crm/metricas/[usuarioId]` - M√©tricas por usuario

#### Dashboard
- `GET /api/crm/dashboard` - Datos para dashboard CRM

---

## üîß Servicios (Services)

### üìã Estructura de Servicios

```
src/lib/services/crm/
‚îú‚îÄ‚îÄ oportunidades.ts       # Gesti√≥n de oportunidades
‚îú‚îÄ‚îÄ actividades.ts         # Gesti√≥n de actividades
‚îú‚îÄ‚îÄ competidores.ts        # Gesti√≥n de competidores
‚îú‚îÄ‚îÄ contactos.ts           # Gesti√≥n de contactos
‚îú‚îÄ‚îÄ historial.ts           # Gesti√≥n de historial de proyectos
‚îú‚îÄ‚îÄ metricas.ts            # C√°lculo de m√©tricas comerciales
‚îî‚îÄ‚îÄ dashboard.ts           # Datos para dashboard
```

### üéØ Servicios Detallados

#### oportunidades.ts
```typescript
export async function getOportunidades(params?: OportunidadFilters): Promise<CrmOportunidad[]>
export async function getOportunidadById(id: string): Promise<CrmOportunidad>
export async function createOportunidad(data: CreateOportunidadData): Promise<CrmOportunidad>
export async function updateOportunidad(id: string, data: UpdateOportunidadData): Promise<CrmOportunidad>
export async function deleteOportunidad(id: string): Promise<void>
export async function getOportunidadesByCliente(clienteId: string): Promise<CrmOportunidad[]>
export async function getOportunidadesByComercial(comercialId: string): Promise<CrmOportunidad[]>
```

#### actividades.ts
```typescript
export async function getActividadesByOportunidad(oportunidadId: string): Promise<CrmActividad[]>
export async function createActividad(data: CreateActividadData): Promise<CrmActividad>
export async function updateActividad(id: string, data: UpdateActividadData): Promise<CrmActividad>
export async function deleteActividad(id: string): Promise<void>
```

#### competidores.ts
```typescript
export async function getCompetidoresByCotizacion(cotizacionId: string): Promise<CrmCompetidorLicitacion[]>
export async function createCompetidor(data: CreateCompetidorData): Promise<CrmCompetidorLicitacion>
export async function updateCompetidor(id: string, data: UpdateCompetidorData): Promise<CrmCompetidorLicitacion>
export async function deleteCompetidor(id: string): Promise<void>
```

#### metricas.ts
```typescript
export async function calcularMetricasUsuario(usuarioId: string, periodo: string): Promise<CrmMetricaComercial>
export async function actualizarMetricasUsuario(usuarioId: string, periodo: string): Promise<void>
export async function getMetricasPeriodo(periodo: string): Promise<CrmMetricaComercial[]>
export async function getMetricasComparativas(): Promise<MetricasComparativas[]>
```

---

## üß© Componentes (Components)

### üìã Estructura de Componentes

```
src/components/crm/
‚îú‚îÄ‚îÄ dashboard/
‚îÇ   ‚îú‚îÄ‚îÄ CrmDashboard.tsx
‚îÇ   ‚îú‚îÄ‚îÄ PipelineChart.tsx
‚îÇ   ‚îú‚îÄ‚îÄ MetricasCards.tsx
‚îÇ   ‚îî‚îÄ‚îÄ ActividadesRecientes.tsx
‚îú‚îÄ‚îÄ oportunidades/
‚îÇ   ‚îú‚îÄ‚îÄ OportunidadList.tsx
‚îÇ   ‚îú‚îÄ‚îÄ OportunidadCard.tsx
‚îÇ   ‚îú‚îÄ‚îÄ OportunidadForm.tsx
‚îÇ   ‚îú‚îÄ‚îÄ OportunidadDetail.tsx
‚îÇ   ‚îú‚îÄ‚îÄ PipelineView.tsx
‚îÇ   ‚îî‚îÄ‚îÄ FiltrosOportunidades.tsx
‚îú‚îÄ‚îÄ actividades/
‚îÇ   ‚îú‚îÄ‚îÄ ActividadList.tsx
‚îÇ   ‚îú‚îÄ‚îÄ ActividadForm.tsx
‚îÇ   ‚îú‚îÄ‚îÄ ActividadTimeline.tsx
‚îÇ   ‚îî‚îÄ‚îÄ ActividadCard.tsx
‚îú‚îÄ‚îÄ competidores/
‚îÇ   ‚îú‚îÄ‚îÄ CompetidorList.tsx
‚îÇ   ‚îú‚îÄ‚îÄ CompetidorForm.tsx
‚îÇ   ‚îú‚îÄ‚îÄ CompetidorCard.tsx
‚îÇ   ‚îî‚îÄ‚îÄ AnalisisCompetidor.tsx
‚îú‚îÄ‚îÄ contactos/
‚îÇ   ‚îú‚îÄ‚îÄ ContactoList.tsx
‚îÇ   ‚îú‚îÄ‚îÄ ContactoForm.tsx
‚îÇ   ‚îú‚îÄ‚îÄ ContactoCard.tsx
‚îÇ   ‚îî‚îÄ‚îÄ OrganigramaContactos.tsx
‚îú‚îÄ‚îÄ historial/
‚îÇ   ‚îú‚îÄ‚îÄ HistorialProyectoList.tsx
‚îÇ   ‚îú‚îÄ‚îÄ HistorialProyectoCard.tsx
‚îÇ   ‚îú‚îÄ‚îÄ ProyectoTimeline.tsx
‚îÇ   ‚îî‚îÄ‚îÄ AnalisisCliente.tsx
‚îú‚îÄ‚îÄ metricas/
‚îÇ   ‚îú‚îÄ‚îÄ MetricasUsuario.tsx
‚îÇ   ‚îú‚îÄ‚îÄ ComparativoVendedores.tsx
‚îÇ   ‚îú‚îÄ‚îÄ TendenciasChart.tsx
‚îÇ   ‚îî‚îÄ‚îÄ RendimientoCharts.tsx
‚îî‚îÄ‚îÄ shared/
    ‚îú‚îÄ‚îÄ CrmFilters.tsx
    ‚îú‚îÄ‚îÄ CrmSearch.tsx
    ‚îú‚îÄ‚îÄ CrmExport.tsx
    ‚îî‚îÄ‚îÄ CrmPagination.tsx
```

### üé® Componentes Principales

#### CrmDashboard.tsx
```tsx
interface CrmDashboardProps {
  userRole: string
  userId: string
}

export default function CrmDashboard({ userRole, userId }: CrmDashboardProps) {
  // Estados
  const [metricas, setMetricas] = useState<MetricasData | null>(null)
  const [oportunidades, setOportunidades] = useState<CrmOportunidad[]>([])
  const [actividades, setActividades] = useState<CrmActividad[]>([])

  // Efectos
  useEffect(() => {
    loadDashboardData()
  }, [userId])

  return (
    <div className="space-y-6">
      <MetricasCards metricas={metricas} />
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <PipelineChart oportunidades={oportunidades} />
        <ActividadesRecientes actividades={actividades} />
      </div>
    </div>
  )
}
```

#### OportunidadList.tsx
```tsx
interface OportunidadListProps {
  oportunidades: CrmOportunidad[]
  onEdit: (oportunidad: CrmOportunidad) => void
  onDelete: (id: string) => void
  loading?: boolean
}

export default function OportunidadList({
  oportunidades,
  onEdit,
  onDelete,
  loading = false
}: OportunidadListProps) {
  if (loading) return <OportunidadSkeleton />

  return (
    <div className="space-y-4">
      {oportunidades.map((oportunidad) => (
        <OportunidadCard
          key={oportunidad.id}
          oportunidad={oportunidad}
          onEdit={() => onEdit(oportunidad)}
          onDelete={() => onDelete(oportunidad.id)}
        />
      ))}
    </div>
  )
}
```

---

## üìÑ P√°ginas (Pages)

### üìã Estructura de P√°ginas

```
src/app/comercial/crm/
‚îú‚îÄ‚îÄ page.tsx                    # Dashboard CRM
‚îú‚îÄ‚îÄ oportunidades/
‚îÇ   ‚îú‚îÄ‚îÄ page.tsx               # Lista de oportunidades
‚îÇ   ‚îú‚îÄ‚îÄ nueva/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx           # Crear nueva oportunidad
‚îÇ   ‚îú‚îÄ‚îÄ [id]/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx           # Detalles de oportunidad
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ editar/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx       # Editar oportunidad
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ actividades/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx       # Actividades de oportunidad
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ competidores/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ page.tsx       # Competidores de oportunidad
‚îú‚îÄ‚îÄ clientes/
‚îÇ   ‚îú‚îÄ‚îÄ [id]/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ contactos/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx       # Contactos del cliente
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ historial/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ page.tsx       # Historial de proyectos
‚îú‚îÄ‚îÄ metricas/
‚îÇ   ‚îú‚îÄ‚îÄ page.tsx               # M√©tricas generales
‚îÇ   ‚îî‚îÄ‚îÄ [usuarioId]/
‚îÇ       ‚îî‚îÄ‚îÄ page.tsx           # M√©tricas por usuario
‚îî‚îÄ‚îÄ reportes/
    ‚îú‚îÄ‚îÄ page.tsx               # Reportes CRM
    ‚îú‚îÄ‚îÄ pipeline/
    ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx           # Reporte de pipeline
    ‚îî‚îÄ‚îÄ rendimiento/
        ‚îî‚îÄ‚îÄ page.tsx           # Reporte de rendimiento
```

### üéØ P√°ginas Principales

#### Dashboard CRM (`/comercial/crm`)
- **Prop√≥sito**: Vista general del estado del CRM
- **Contenido**:
  - M√©tricas principales (oportunidades, valor pipeline, conversi√≥n)
  - Gr√°fico de pipeline por etapas
  - Actividades recientes
  - Alertas y recordatorios
- **Permisos**: comercial, coordinador, gerente

#### Lista de Oportunidades (`/comercial/crm/oportunidades`)
- **Prop√≥sito**: Gesti√≥n del pipeline de ventas
- **Funcionalidades**:
  - Lista filtrable de oportunidades
  - Vista de kanban/pipeline
  - B√∫squeda avanzada
  - Exportaci√≥n de datos
- **Filtros**: cliente, comercial, estado, fecha, valor

#### Detalle de Oportunidad (`/comercial/crm/oportunidades/[id]`)
- **Prop√≥sito**: Gesti√≥n detallada de una oportunidad
- **Secciones**:
  - Informaci√≥n general
  - Historial de actividades
  - Competidores
  - Documentos adjuntos
  - Conversi√≥n a cotizaci√≥n/proyecto

---

## üîÑ Flujo de Trabajo (Workflow)

### üìã Flujo Principal: Oportunidad ‚Üí Cotizaci√≥n ‚Üí Proyecto

```mermaid
graph TD
    A[Identificar Oportunidad] --> B[Crear Oportunidad CRM]
    B --> C[Registrar Actividades]
    C --> D[Evaluar Viabilidad]
    D --> E{Cotizaci√≥n Requerida?}
    E -->|S√≠| F[Crear Cotizaci√≥n]
    E -->|No| G[Seguimiento Continuo]
    F --> H[Enviar Propuesta]
    H --> I[Seguimiento Post-Env√≠o]
    I --> J{Resultado}
    J -->|Ganada| K[Crear Proyecto]
    J -->|Perdida| L[Registrar Raz√≥n P√©rdida]
    J -->|Pendiente| I
    K --> M[Actualizar Historial Cliente]
    L --> M
    G --> B
```

### üéØ Estados de Oportunidad

1. **Prospecto**: Cliente potencial identificado
2. **Contacto Inicial**: Primer contacto establecido
3. **Cotizaci√≥n**: Propuesta enviada
4. **Negociaci√≥n**: En proceso de negociaci√≥n
5. **Cerrada Ganada**: Proyecto adjudicado
6. **Cerrada Perdida**: Proyecto perdido

### üìä M√©tricas y KPIs

#### Individuales por Usuario
- N√∫mero de oportunidades creadas
- Tasa de conversi√≥n (oportunidades ‚Üí proyectos)
- Valor promedio de proyectos cerrados
- Tiempo promedio de cierre
- N√∫mero de actividades realizadas

#### Globales
- Valor total del pipeline
- Tasa de conversi√≥n general
- Distribuci√≥n por etapas
- Rendimiento por sector industrial

---

## üîó Integraci√≥n con Sistema Existente

### üìã Puntos de Integraci√≥n

#### 1. Cotizaciones
- **Enlace**: Una oportunidad puede tener una cotizaci√≥n asociada
- **Flujo**: Desde oportunidad ‚Üí crear cotizaci√≥n
- **Sincronizaci√≥n**: Actualizar estado de oportunidad cuando cotizaci√≥n cambia

#### 2. Proyectos
- **Enlace**: Proyecto creado desde cotizaci√≥n actualiza historial del cliente
- **Flujo**: Proyecto cerrado ‚Üí actualizar m√©tricas comerciales
- **Datos**: Valor real, margen obtenido, duraci√≥n, calificaci√≥n

#### 3. Clientes
- **Enriquecimiento**: Agregar campos CRM al modelo Cliente
- **Historial**: Vincular oportunidades, contactos, proyectos hist√≥ricos
- **Segmentaci√≥n**: Por sector, tama√±o, frecuencia de compra

### üîÑ Sincronizaci√≥n de Datos

#### Actualizaci√≥n Autom√°tica
- **Cotizaci√≥n ‚Üí Oportunidad**: Cambiar estado cuando se env√≠a cotizaci√≥n
- **Proyecto ‚Üí Cliente**: Actualizar √∫ltimo proyecto y m√©tricas
- **Actividad ‚Üí M√©tricas**: Contabilizar actividades realizadas

#### Triggers de Base de Datos
- Actualizar m√©tricas comerciales al cerrar proyecto
- Cambiar estado de oportunidad al crear cotizaci√≥n
- Notificar actividades pendientes

---

## üé® Interfaz de Usuario (UI/UX)

### üìã Dise√±o General

#### Paleta de Colores
- **Primario**: Azul corporativo (#0066CC)
- **Secundario**: Verde para ganancias (#28A745)
- **Advertencia**: Naranja para pendientes (#FFC107)
- **Error**: Rojo para p√©rdidas (#DC3545)
- **Neutro**: Gris para estados inactivos (#6C757D)

#### Componentes Base
- **Cards**: Para oportunidades, actividades, m√©tricas
- **Tables**: Para listas de datos
- **Charts**: Para visualizaci√≥n de m√©tricas
- **Forms**: Para creaci√≥n/edici√≥n
- **Modals**: Para acciones r√°pidas

### üìä Dashboard Layout

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ HEADER: T√≠tulo + Filtros + Acciones             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ NAVIGATION      ‚îÇ MAIN CONTENT                  ‚îÇ
‚îÇ ‚Ä¢ Dashboard     ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ ‚Ä¢ Oportunidades ‚îÇ ‚îÇ M√âTRICAS CARDS          ‚îÇ   ‚îÇ
‚îÇ ‚Ä¢ Clientes      ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ ‚Ä¢ M√©tricas      ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ ‚Ä¢ Reportes      ‚îÇ ‚îÇ PIPELINE CHART          ‚îÇ   ‚îÇ
‚îÇ                 ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                 ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ                 ‚îÇ ‚îÇ ACTIVIDADES RECIENTES   ‚îÇ   ‚îÇ
‚îÇ                 ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîê Permisos y Seguridad

### üë• Roles y Permisos

#### Administrador
- Acceso completo a todas las funciones
- Gesti√≥n de usuarios y permisos
- Configuraci√≥n del sistema

#### Gerente
- Dashboard completo
- Todas las m√©tricas
- Aprobaci√≥n de oportunidades
- Gesti√≥n de usuarios de su equipo

#### Coordinador
- Dashboard de equipo
- Gesti√≥n de oportunidades
- Creaci√≥n de cotizaciones
- Acceso a m√©tricas de equipo

#### Comercial
- Dashboard personal
- Gesti√≥n de sus oportunidades
- Creaci√≥n de actividades
- Acceso a sus m√©tricas

### üîí Control de Acceso

#### A Nivel de Registro
- Usuario solo ve sus oportunidades (salvo gerente/coordinador)
- Cliente solo ve sus datos
- M√©tricas filtradas por permisos

#### A Nivel de Operaci√≥n
- Solo propietario puede editar oportunidad
- Solo gerente puede eliminar registros
- Validaci√≥n de permisos en API

---

## üìà M√©tricas y Reportes

### üìä Tipos de Reportes

#### 1. Dashboard Ejecutivo
- Pipeline total por etapas
- Valor del pipeline
- Tasa de conversi√≥n
- Rendimiento por comercial

#### 2. Reporte de Pipeline
- Oportunidades por etapa
- Valor por etapa
- Tiempo en cada etapa
- Cuellos de botella

#### 3. Reporte de Rendimiento
- M√©tricas por comercial
- Comparativo entre vendedores
- Tendencias mensuales
- Objetivos vs. realidad

#### 4. Reporte de Clientes
- Historial de proyectos por cliente
- Valor total por cliente
- Frecuencia de proyectos
- Satisfacci√≥n del cliente

### üìà KPIs Principales

#### Pipeline
- Valor total del pipeline
- N√∫mero de oportunidades activas
- Tasa de conversi√≥n por etapa
- Tiempo promedio en pipeline

#### Rendimiento
- N√∫mero de oportunidades creadas/mes
- Tasa de cierre (ganadas vs perdidas)
- Valor promedio de proyectos
- Margen promedio obtenido

#### Eficiencia
- N√∫mero de actividades por oportunidad
- Tiempo de respuesta a leads
- Tasa de conversi√≥n de leads

---

## üöÄ Plan de Implementaci√≥n

### üìÖ Fases de Desarrollo

#### Fase 1: Base de Datos y APIs (Semana 1-2)
- [ ] Crear modelos Prisma
- [ ] Ejecutar migraciones
- [ ] Implementar APIs b√°sicas (CRUD)
- [ ] Crear servicios base

#### Fase 2: Componentes Core (Semana 3-4)
- [ ] Dashboard CRM
- [ ] Gesti√≥n de oportunidades
- [ ] Gesti√≥n de actividades
- [ ] Gesti√≥n de competidores

#### Fase 3: Funcionalidades Avanzadas (Semana 5-6)
- [ ] Gesti√≥n de contactos
- [ ] Historial de proyectos
- [ ] Sistema de m√©tricas
- [ ] Reportes y gr√°ficos

#### Fase 4: Integraci√≥n y Testing (Semana 7-8)
- [ ] Integraci√≥n con cotizaciones
- [ ] Integraci√≥n con proyectos
- [ ] Testing completo
- [ ] Optimizaci√≥n de performance

#### Fase 5: Despliegue y Capacitaci√≥n (Semana 9)
- [ ] Despliegue en producci√≥n
- [ ] Migraci√≥n de datos existentes
- [ ] Capacitaci√≥n de usuarios
- [ ] Documentaci√≥n final

### üéØ Criterios de √âxito

#### Funcionales
- ‚úÖ Gesti√≥n completa del pipeline de ventas
- ‚úÖ Seguimiento de actividades por oportunidad
- ‚úÖ An√°lisis de competidores en licitaciones
- ‚úÖ Historial completo de proyectos por cliente
- ‚úÖ M√©tricas y KPIs de rendimiento comercial

#### T√©cnicos
- ‚úÖ Performance √≥ptima (< 2s carga de dashboard)
- ‚úÖ Integraci√≥n perfecta con sistema existente
- ‚úÖ Seguridad y permisos implementados
- ‚úÖ Responsive design para m√≥viles

#### de Usuario
- ‚úÖ Interfaz intuitiva y f√°cil de usar
- ‚úÖ Flujo de trabajo claro y eficiente
- ‚úÖ Informaci√≥n relevante y actionable
- ‚úÖ Capacitaci√≥n m√≠nima requerida

---

## üìö Documentaci√≥n Adicional

### üìã Glosario de T√©rminos

- **Oportunidad**: Posible proyecto o venta identificada
- **Pipeline**: Embudo de ventas con todas las oportunidades
- **Lead**: Prospecto o cliente potencial
- **Conversi√≥n**: Tasa de oportunidades que se convierten en proyectos
- **Ciclo de Ventas**: Tiempo desde identificaci√≥n hasta cierre

### üîó Referencias

- [Documentaci√≥n Prisma](https://www.prisma.io/docs)
- [Next.js Documentation](https://nextjs.org/docs)
- [Tailwind CSS](https://tailwindcss.com/docs)
- [CRM Best Practices](https://www.salesforce.com/resources/articles/what-is-crm/)

---

## üìû Soporte y Mantenimiento

### üë• Equipo de Desarrollo
- **L√≠der de Proyecto**: Jes√∫s Artemio
- **Desarrollador Frontend**: Equipo de desarrollo
- **Desarrollador Backend**: Equipo de desarrollo
- **QA/Tester**: Equipo de QA

### üîÑ Mantenimiento
- **Versiones**: Releases mensuales con nuevas funcionalidades
- **Hotfixes**: Correcci√≥n de bugs cr√≠ticos en 24-48 horas
- **Soporte**: Ticket system para reportes de issues
- **Monitoreo**: Alertas autom√°ticas para performance y errores

---

*Documento creado: 19 de septiembre de 2025*
*Versi√≥n: 1.0*
*Autor: Sistema GYS - Asistente IA*